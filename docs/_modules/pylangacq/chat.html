<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.03.04"/>
        <title>pylangacq.chat - PyLangAcq 0.16.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=935aa2abcc5c1da4283d1dc201fb1f0add16d23a" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=25ceb02ed1c46dc30f2321ff83e92799f69dfdb9" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">PyLangAcq 0.16.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">PyLangAcq 0.16.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../read.html">Reading CHAT Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../headers.html">Accessing Headers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transcriptions.html">Transcriptions and Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../write.html">Writing CHAT Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frequencies.html">Word Frequencies and Ngrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../measures.html">Developmental Measures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for pylangacq.chat</h1><div class="highlight"><pre>
<span></span><span class="sd">"""Interfacing with CHAT data files."""</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">concurrent.futures</span> <span class="k">as</span> <span class="nn">cf</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests.adapters</span> <span class="kn">import</span> <span class="n">HTTPAdapter</span>
<span class="kn">from</span> <span class="nn">requests.packages.urllib3.util.retry</span> <span class="kn">import</span> <span class="n">Retry</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">parse_date</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">ParserError</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">pylangacq</span>
<span class="kn">from</span> <span class="nn">pylangacq.measures</span> <span class="kn">import</span> <span class="n">_get_ipsyn</span><span class="p">,</span> <span class="n">_get_mlum</span><span class="p">,</span> <span class="n">_get_mluw</span><span class="p">,</span> <span class="n">_get_ttr</span>
<span class="kn">from</span> <span class="nn">pylangacq.objects</span> <span class="kn">import</span> <span class="n">Gra</span><span class="p">,</span> <span class="n">Token</span><span class="p">,</span> <span class="n">Utterance</span><span class="p">,</span> <span class="n">_sort_keys</span><span class="p">,</span> <span class="n">_CLITIC</span>
<span class="kn">from</span> <span class="nn">pylangacq._clean_utterance</span> <span class="kn">import</span> <span class="n">_clean_utterance</span>


<span class="n">_ENCODING</span> <span class="o">=</span> <span class="s2">"utf-8"</span>

<span class="n">_CHAT_EXTENSION</span> <span class="o">=</span> <span class="s2">".cha"</span>

<span class="n">_TIMER_MARKS_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\x15-?(\d+)_(\d+)-?\x15"</span><span class="p">)</span>

<span class="n">_CACHED_DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">"~"</span><span class="p">),</span> <span class="s2">".pylangacq"</span><span class="p">)</span>
<span class="n">_CACHED_DATA_JSON_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">,</span> <span class="s2">"cached_data.json"</span><span class="p">)</span>

<span class="n">_CHAT_LINE_INDICATORS</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">({</span><span class="s2">"@"</span><span class="p">,</span> <span class="s2">"*"</span><span class="p">,</span> <span class="s2">"%"</span><span class="p">})</span>

<span class="n">_HEADER_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"\A@([^@:]+)(:\s+(\S[\S\s]+))?\Z"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_params_in_docstring</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="n">class_method</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">docstring</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="s2">"participants"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        participants : str or iterable of str, optional</span>
<span class="s2">            Participants of interest. You may pass in a string (e.g., ``"CHI"``</span>
<span class="s2">            for studying child speech)</span>
<span class="s2">            or an iterable of strings (e.g., ``{"MOT", "INV"}``). Only the specified</span>
<span class="s2">            participants are included.</span>
<span class="s2">            If you pass in ``None`` (the default), all participants are included.</span>
<span class="s2">            This parameter cannot be used together with ``exclude``.</span>
<span class="s2">        exclude : str or iterable of str, optional</span>
<span class="s2">            Participants to exclude. You may pass in a string (e.g., ``"CHI"``</span>
<span class="s2">            for child-directed speech)</span>
<span class="s2">            or an iterable of strings (e.g., ``{"MOT", "INV"}``). Only the specified</span>
<span class="s2">            participants are excluded.</span>
<span class="s2">            If you pass in ``None`` (the default), no participants are excluded.</span>
<span class="s2">            This parameter cannot be used together with ``participants``."""</span>

    <span class="k">if</span> <span class="s2">"by_utterances"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        by_utterances : bool, optional</span>
<span class="s2">            If ``True``, the resulting objects are wrapped as a list at the utterance</span>
<span class="s2">            level.</span>
<span class="s2">            If ``False`` (the default), such utterance-level list structure</span>
<span class="s2">            does not exist."""</span>

    <span class="k">if</span> <span class="s2">"by_files"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        by_files : bool, optional</span>
<span class="s2">            If ``True``, return a list X of results, where len(X) is the number of</span>
<span class="s2">            files in the ``Reader`` object, and each element in X is the result for one</span>
<span class="s2">            file; the ordering of X corresponds to that of the file paths from</span>
<span class="s2">            :func:`~pylangacq.Reader.file_paths`.</span>
<span class="s2">            If ``False`` (the default), return the result that collapses the file</span>
<span class="s2">            distinction just described for when ``by_files`` is ``True``."""</span>

    <span class="k">if</span> <span class="s2">"keep_case"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        keep_case : bool, optional</span>
<span class="s2">            If ``True`` (the default), case distinctions are kept, e.g.,</span>
<span class="s2">            word tokens like "the" and "The" are treated as distinct.</span>
<span class="s2">            If ``False``, all word tokens are forced to be in lowercase</span>
<span class="s2">            as a preprocessing step.</span>
<span class="s2">            CHAT data from CHILDES intentionally does not follow the orthographic</span>
<span class="s2">            convention of capitalizing the first letter of a sentence in the</span>
<span class="s2">            transcriptions (as would have been done in many European languages),</span>
<span class="s2">            and so leaving keep_case as True is appropriate in most cases."""</span>

    <span class="k">if</span> <span class="s2">"match"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        match : str, optional</span>
<span class="s2">            If provided, only the file paths that match this string</span>
<span class="s2">            (by regular expression matching) are read and parsed.</span>
<span class="s2">            For example, to work with the American English dataset Brown (containing</span>
<span class="s2">            data for the children Adam, Eve, and Sarah),</span>
<span class="s2">            you can pass in ``"Eve"`` here to only handle the data for Eve, since</span>
<span class="s2">            the unzipped Brown data from CHILDES has a directory structure of</span>
<span class="s2">            ``Brown/Eve/xxx.cha`` for Eve's data.</span>
<span class="s2">            If this parameter is not specified or ``None`` is passed in (the default),</span>
<span class="s2">            such file path filtering does not apply.</span>
<span class="s2">        exclude : str, optional</span>
<span class="s2">            If provided, the file paths that match this string (by regular expression</span>
<span class="s2">            matching) are excluded for reading and parsing."""</span>

    <span class="k">if</span> <span class="s2">"encoding"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        encoding : str, optional</span>
<span class="s2">            Text encoding to parse the CHAT data. The default value is ``"utf-8"``</span>
<span class="s2">            for Unicode UTF-8."""</span>

    <span class="k">if</span> <span class="s2">"extension"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        extension : str, optional</span>
<span class="s2">            File extension for CHAT data files. The default value is ``".cha"``."""</span>

    <span class="k">if</span> <span class="s2">"cls"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        cls : type, optional</span>
<span class="s2">            Either :class:`~pylangacq.Reader` (the default),</span>
<span class="s2">            or a subclass from it that expects the same arguments for the methods</span>
<span class="s2">            :func:`~pylangacq.Reader.from_zip`, :func:`~pylangacq.Reader.from_dir`,</span>
<span class="s2">            and :func:`~pylangacq.Reader.from_files`.</span>
<span class="s2">            Pass in your own :class:`~pylangacq.Reader` subclass</span>
<span class="s2">            for new or modified behavior of the returned reader object."""</span>

    <span class="k">if</span> <span class="s2">"parallel"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        parallel : bool, optional</span>
<span class="s2">            If ``True`` (the default), CHAT reading and parsing is parallelized</span>
<span class="s2">            for speed-up, because in most cases multiple CHAT data files and/or strings</span>
<span class="s2">            are being handled.</span>
<span class="s2">            Under certain circumstances (e.g., your application is already parallelized</span>
<span class="s2">            and further parallelization from within PyLangAcq might be undesirable),</span>
<span class="s2">            you may like to consider setting this parameter to ``False``."""</span>

    <span class="k">if</span> <span class="s2">"use_cached"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        use_cached : bool, optional</span>
<span class="s2">            If ``True`` (the default), and if the path is a URL for a remote ZIP</span>
<span class="s2">            archive, then CHAT reading attempts to use the previously downloaded</span>
<span class="s2">            data cached on disk. This setting allows you to call</span>
<span class="s2">            this function with the same URL repeatedly without hitting the CHILDES /</span>
<span class="s2">            TalkBank server more than once for the same data.</span>
<span class="s2">            Pass in ``False`` to force a new download; the upstream CHILDES / TalkBank</span>
<span class="s2">            data is updated in minor ways from time to time, e.g., for CHAT format,</span>
<span class="s2">            header/metadata information, updated annotations.</span>
<span class="s2">            See also the helper functions: :func:`pylangacq.chat.cached_data_info`,</span>
<span class="s2">            :func:`pylangacq.chat.remove_cached_data`."""</span>

    <span class="k">if</span> <span class="s2">"session"</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">+=</span> <span class="s2">"""</span>
<span class="s2">        session : requests.Session, optional</span>
<span class="s2">            If the path is a URL for a remote ZIP archive, data downloading is</span>
<span class="s2">            done with reasonable settings of retries and timeout by default,</span>
<span class="s2">            in order to be robust against intermittent network issues.</span>
<span class="s2">            If necessary, pass in your own instance of :class:`requests.Session`</span>
<span class="s2">            to customize."""</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">class_method</span><span class="p">:</span>
        <span class="n">docstring</span> <span class="o">=</span> <span class="n">docstring</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">        "</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">    "</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">real_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">returns_none</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Returns</span><span class="se">\n</span><span class="si">{</span><span class="s1">'        '</span> <span class="k">if</span> <span class="n">class_method</span> <span class="k">else</span> <span class="s1">'    '</span><span class="si">}</span><span class="s2">-------"</span>
            <span class="ow">not</span> <span class="ow">in</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">returns_none</span><span class="p">:</span>
            <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="n">docstring</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">class_method</span><span class="p">:</span>
                <span class="n">returns_header</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">        Returns</span><span class="se">\n</span><span class="s2">        -------"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">returns_header</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">    Returns</span><span class="se">\n</span><span class="s2">    -------"</span>
            <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">returns_header</span><span class="p">,</span> <span class="n">docstring</span> <span class="o">+</span> <span class="n">returns_header</span>
            <span class="p">)</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">real_decorator</span>


<span class="k">def</span> <span class="nf">_deprecate_warning</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">since_version</span><span class="p">,</span> <span class="n">use_instead</span><span class="p">):</span>
    <span class="sd">"""Throws a FutureWarning for deprecation.</span>

<span class="sd">    FutureWarning is used instead of DeprecationWarning, because Python</span>
<span class="sd">    does not show DeprecationWarning by default.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    what : str</span>
<span class="sd">        What to deprecate.</span>
<span class="sd">    since_version : str</span>
<span class="sd">        Version "x.y.z" since which the deprecation is in effect.</span>
<span class="sd">    use_instead : str</span>
<span class="sd">        Use this instead.</span>
<span class="sd">    """</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"'</span><span class="si">{</span><span class="n">what</span><span class="si">}</span><span class="s2">' has been deprecated since PyLangAcq v</span><span class="si">{</span><span class="n">since_version</span><span class="si">}</span><span class="s2">. "</span>
        <span class="sa">f</span><span class="s2">"Please use </span><span class="si">{</span><span class="n">use_instead</span><span class="si">}</span><span class="s2"> instead."</span><span class="p">,</span>
        <span class="ne">FutureWarning</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">_list</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_to_str</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">_File</span><span class="p">:</span>
    <span class="sd">"""A CHAT file (or string).</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path : str</span>
<span class="sd">    header : dict</span>
<span class="sd">    utterances : List[Utterance]</span>
<span class="sd">    """</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">"file_path"</span><span class="p">,</span> <span class="s2">"header"</span><span class="p">,</span> <span class="s2">"utterances"</span><span class="p">)</span>

    <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">header</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">utterances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]</span>


<div class="viewcode-block" id="Reader"><a class="viewcode-back" href="../../api.html#pylangacq.Reader">[docs]</a><span class="k">class</span> <span class="nc">Reader</span><span class="p">:</span>
    <span class="sd">"""A reader that handles CHAT data."""</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Initialize an empty reader."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_chat_strs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">strs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">file_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">cf</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span>
                    <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_chat_str</span><span class="p">,</span> <span class="n">strs</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parse_chat_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">"__len__ of a CHAT reader is intentionally undefined. "</span>
            <span class="s2">"Intuitively, there are different lengths one may refer to: "</span>
            <span class="s2">"Number of files in this reader? Utterances? Words? Something else?"</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_reader_from_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">_File</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reader</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield from</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_reader_from_files</span><span class="p">([</span><span class="n">f</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader_from_files</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">[</span><span class="n">item</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">slice</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">))</span>
            <span class="c1"># Slicing of a list etc would give us a _shallow_ copy of the container,</span>
            <span class="c1"># and so we follow the shallow copying practice here for the files.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader_from_files</span><span class="p">(</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Reader indices must be integers or slices, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">"Mutating the CHAT reader by targeting the individual files through "</span>
            <span class="s2">"indices is not supported. Please use the implemented Reader object "</span>
            <span class="s2">"methods to add or remove data."</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Reader.clear"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Remove all data from this reader."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">"pylangacq.Reader"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Reader</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'cannot concatenate "</span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="si">}</span><span class="s1">" to a reader'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader_from_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_or_right</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="s2">"pylangacq.Reader"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="s2">"extendleft"</span> <span class="k">if</span> <span class="n">left_or_right</span> <span class="o">==</span> <span class="s2">"left"</span> <span class="k">else</span> <span class="s2">"extend"</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Reader</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"not a Reader object: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">,</span> <span class="n">func</span><span class="p">)(</span><span class="n">reader</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>

<div class="viewcode-block" id="Reader.append"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="s2">"pylangacq.Reader"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Append data from another reader.</span>

<span class="sd">        New data is appended as-is with no filtering of any sort,</span>
<span class="sd">        even for files whose file paths duplicate those already in the current reader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reader : Reader</span>
<span class="sd">            A reader from which to append data</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append</span><span class="p">(</span><span class="s2">"right"</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.append_left"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.append_left">[docs]</a>    <span class="k">def</span> <span class="nf">append_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="s2">"pylangacq.Reader"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Left-append data from another reader.</span>

<span class="sd">        New data is appended as-is with no filtering of any sort,</span>
<span class="sd">        even for files whose file paths duplicate those already in the current reader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reader : Reader</span>
<span class="sd">            A reader from which to left-append data</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_append</span><span class="p">(</span><span class="s2">"left"</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_or_right</span><span class="p">,</span> <span class="n">readers</span><span class="p">:</span> <span class="s2">"Iterable[pylangacq.Reader]"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Loop through each object in ``readers`` explicitly, so that we have</span>
        <span class="c1"># a chance to check that the object is indeed a Reader instance.</span>
        <span class="n">new_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="n">readers</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Reader</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"not a Reader object: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">new_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="s2">"extendleft"</span> <span class="k">if</span> <span class="n">left_or_right</span> <span class="o">==</span> <span class="s2">"left"</span> <span class="k">else</span> <span class="s2">"extend"</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">,</span> <span class="n">func</span><span class="p">)(</span><span class="n">new_files</span><span class="p">)</span>

<div class="viewcode-block" id="Reader.extend"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readers</span><span class="p">:</span> <span class="s2">"Iterable[pylangacq.Reader]"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Extend data from other readers.</span>

<span class="sd">        New data is appended as-is with no filtering of any sort,</span>
<span class="sd">        even for files whose file paths duplicate those already in the current reader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        readers : Iterable[Reader]</span>
<span class="sd">            Readers from which to extend data</span>
<span class="sd">        """</span>
        <span class="c1"># Loop through each object in ``readers`` explicitly, so that we have</span>
        <span class="c1"># a chance to check that the object is indeed a Reader instance.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extend</span><span class="p">(</span><span class="s2">"right"</span><span class="p">,</span> <span class="n">readers</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.extend_left"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.extend_left">[docs]</a>    <span class="k">def</span> <span class="nf">extend_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readers</span><span class="p">:</span> <span class="s2">"Iterable[pylangacq.Reader]"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Left-extend data from other readers.</span>

<span class="sd">        New data is appended as-is with no filtering of any sort,</span>
<span class="sd">        even for files whose file paths duplicate those already in the current reader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        readers : Iterable[Reader]</span>
<span class="sd">            Readers from which to extend data</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extend</span><span class="p">(</span><span class="s2">"left"</span><span class="p">,</span> <span class="n">readers</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_or_right</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="s2">"popleft"</span> <span class="k">if</span> <span class="n">left_or_right</span> <span class="o">==</span> <span class="s2">"left"</span> <span class="k">else</span> <span class="s2">"pop"</span>
        <span class="n">file_</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">,</span> <span class="n">func</span><span class="p">)()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader_from_files</span><span class="p">([</span><span class="n">file_</span><span class="p">])</span>

<div class="viewcode-block" id="Reader.pop"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Drop the last data file from the reader and return it as a reader.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop</span><span class="p">(</span><span class="s2">"right"</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.pop_left"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.pop_left">[docs]</a>    <span class="k">def</span> <span class="nf">pop_left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Drop the first data file from the reader and return it as a reader.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pop</span><span class="p">(</span><span class="s2">"left"</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.filter"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.filter">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"match"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">match</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Return a new reader filtered by file paths.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If neither ``match`` nor ``exclude`` is specified.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">"At least one of {match, exclude} must be specified"</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">file_paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_file_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">(),</span> <span class="n">match</span><span class="p">,</span> <span class="n">exclude</span><span class="p">))</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span>
            <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">file_path</span> <span class="ow">in</span> <span class="n">file_paths</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">reader</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_flatten</span><span class="p">(</span><span class="n">item_type</span><span class="p">,</span> <span class="n">nested</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">item_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">nested</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">item_type</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nested</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">item_type</span> <span class="o">==</span> <span class="nb">set</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">nested</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">item_type</span> <span class="o">==</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"unrecognized item type: </span><span class="si">{</span><span class="n">item_type</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<div class="viewcode-block" id="Reader.utterances"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.utterances">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">utterances</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]]]:</span>
        <span class="sd">"""Return the utterances.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Utterance] if ``by_files`` is ``False``, otherwise List[List[Utterance]]</span>
<span class="sd">        """</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_utterances_by_participants</span><span class="p">(</span><span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_result_by_utterances_by_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">by_utterances</span><span class="p">,</span> <span class="n">by_files</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">by_files</span> <span class="ow">and</span> <span class="n">by_utterances</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">by_files</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">by_utterances</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">by_files</span> <span class="ow">and</span> <span class="n">by_utterances</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not by_files and not by_utterances</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Reader.tokens"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.tokens">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_utterances"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">tokens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_utterances</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]]]]:</span>
        <span class="sd">"""Return the tokens.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[List[List[Token]]] if both ``by_utterances`` and ``by_files`` are ``True``</span>
<span class="sd">        List[List[Token]] if ``by_utterances`` is ``True`` and ``by_files`` is ``False``</span>
<span class="sd">        List[List[Token]] if ``by_utterances`` is ``False`` and ``by_files`` is ``True``</span>
<span class="sd">        List[Token] if both ``by_utterances`` and ``by_files`` are ``False``</span>
<span class="sd">        """</span>
        <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utterances</span><span class="p">(</span>
            <span class="n">participants</span><span class="o">=</span><span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[[</span><span class="n">u</span><span class="o">.</span><span class="n">tokens</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">us</span><span class="p">]</span> <span class="k">for</span> <span class="n">us</span> <span class="ow">in</span> <span class="n">utterances</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_result_by_utterances_by_files</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">by_utterances</span><span class="p">,</span> <span class="n">by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.words"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.words">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_utterances"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">words</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_utterances</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]:</span>
        <span class="sd">"""Return the words.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[List[List[str]]] if both ``by_utterances`` and ``by_files`` are ``True``</span>
<span class="sd">        List[List[str]] if ``by_utterances`` is ``True`` and ``by_files`` is ``False``</span>
<span class="sd">        List[List[str]] if ``by_utterances`` is ``False`` and ``by_files`` is ``True``</span>
<span class="sd">        List[str] if both ``by_utterances`` and ``by_files`` are ``False``</span>
<span class="sd">        """</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">(</span>
            <span class="n">participants</span><span class="o">=</span><span class="n">participants</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
            <span class="n">by_utterances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[[</span><span class="n">t</span><span class="o">.</span><span class="n">word</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">word</span> <span class="o">!=</span> <span class="n">_CLITIC</span><span class="p">]</span> <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">tss</span><span class="p">]</span> <span class="k">for</span> <span class="n">tss</span> <span class="ow">in</span> <span class="n">tokens</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_result_by_utterances_by_files</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">by_utterances</span><span class="p">,</span> <span class="n">by_files</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_filter_utterances_by_participants</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">participants</span> <span class="ow">and</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">"participants and exclude cannot be specified at the same time: "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">participants</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">exclude</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">participants</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">participants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">participants</span><span class="p">(</span><span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">participants</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">participants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="n">participants</span><span class="p">}</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_files</span><span class="p">())]</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">participants</span><span class="p">,</span> <span class="s2">"__iter__"</span><span class="p">):</span>
            <span class="n">participants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">participants</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_files</span><span class="p">())]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"participants must be one of {None, a string, an iterable of strings}: "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">participants</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">participants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">-</span> <span class="p">{</span><span class="n">exclude</span><span class="p">}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">participants</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">exclude</span><span class="p">,</span> <span class="s2">"__iter__"</span><span class="p">):</span>
            <span class="n">participants</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">participants</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"exclude must be one of {None, a string, an iterable of strings}: "</span>
                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">exclude</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">us</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">participant</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">us</span><span class="p">,</span> <span class="n">ps</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">utterances</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">],</span> <span class="n">participants</span><span class="p">)</span>
        <span class="p">]</span>

<div class="viewcode-block" id="Reader.headers"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.headers">[docs]</a>    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sd">"""Return the headers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Dict]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">header</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span></div>

<div class="viewcode-block" id="Reader.file_paths"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.file_paths">[docs]</a>    <span class="k">def</span> <span class="nf">file_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">"""Return the file paths.</span>

<span class="sd">        If the data comes from in-memory strings, then the "file paths" are</span>
<span class="sd">        arbitrary UUID random strings.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">file_path</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span></div>

<div class="viewcode-block" id="Reader.n_files"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.n_files">[docs]</a>    <span class="k">def</span> <span class="nf">n_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Return the number of files."""</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.participants"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.participants">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">participants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">"""Return the participants (e.g., CHI, MOT).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Set[str] if ``by_files`` is ``False``, otherwise List[Set[str]]</span>
<span class="sd">        """</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[{</span><span class="n">u</span><span class="o">.</span><span class="n">participant</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">utterances</span><span class="p">}</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.languages"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.languages">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">languages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
        <span class="sd">"""Return the languages in the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Set[str] if ``by_files`` is ``False``, otherwise List[List[str]]</span>
<span class="sd">            When ``by_files`` is ``True``, the ordering of languages given by the list</span>
<span class="sd">            indicates language dominance. Such ordering would not make sense when</span>
<span class="sd">            ``by_files`` is ``False``, in which case the returned object is a set</span>
<span class="sd">            instead of a list.</span>
<span class="sd">        """</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Languages"</span><span class="p">,</span> <span class="p">[])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">))</span></div>

<div class="viewcode-block" id="Reader.dates_of_recording"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.dates_of_recording">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dates_of_recording</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">]]]:</span>
        <span class="sd">"""Return the dates of recording.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Set[datetime.date] if ``by_files`` is ``False``,</span>
<span class="sd">        otherwise List[Set[datetime.date]]]</span>
<span class="sd">        """</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Date"</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.ages"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.ages">[docs]</a>    <span class="k">def</span> <span class="nf">ages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participant</span><span class="o">=</span><span class="s2">"CHI"</span><span class="p">,</span> <span class="n">months</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">"""Return the ages of the given participant in the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        participant : str, optional</span>
<span class="sd">            Participant of interest, which defaults to the typical use case of ``"CHI"``</span>
<span class="sd">            for the target child.</span>
<span class="sd">        months : bool, optional</span>
<span class="sd">            If ``False`` (the default), age is represented as a tuple of</span>
<span class="sd">            (years, months, days), e.g., "1;06.00" in CHAT becomes ``(1, 6, 0)``.</span>
<span class="sd">            If ``True``, age is a float for the number of months,</span>
<span class="sd">            e.g., "1;06.00" in CHAT becomes ``18.0`` for 18 months.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Tuple[int, int, int]] if ``months`` is ``False``, otherwise List[float]</span>
<span class="sd">        """</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">age</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">][</span><span class="n">participant</span><span class="p">][</span><span class="s2">"age"</span><span class="p">]</span>

                <span class="n">year_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">month_day</span> <span class="o">=</span> <span class="n">age</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">";"</span><span class="p">)</span>
                <span class="n">month_str</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">day_str</span> <span class="o">=</span> <span class="n">month_day</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span>

                <span class="n">year_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">year_str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">month_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">month_str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">day_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">day_str</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>

                <span class="k">if</span> <span class="n">months</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">year_int</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">month_int</span> <span class="o">+</span> <span class="n">day_int</span> <span class="o">/</span> <span class="mi">30</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">year_int</span><span class="p">,</span> <span class="n">month_int</span><span class="p">,</span> <span class="n">day_int</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">result_by_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_by_files</span></div>

<div class="viewcode-block" id="Reader.tagged_sents"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.tagged_sents">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">tagged_sents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]]]]:</span>
        <span class="sd">"""Return the tagged sents.</span>

<span class="sd">        .. deprecated:: 0.13.0</span>
<span class="sd">            Please use :func:`~pylangacq.Reader.tokens` with ``by_utterances=True``</span>
<span class="sd">            instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[List[Token]] if ``by_files`` is ``False``,</span>
<span class="sd">        otherwise List[List[List[Token]]]</span>
<span class="sd">        """</span>
        <span class="n">_deprecate_warning</span><span class="p">(</span>
            <span class="s2">"tagged_sents"</span><span class="p">,</span>
            <span class="s2">"0.13.0"</span><span class="p">,</span>
            <span class="s2">"the `.tokens()` method with by_utterances=True"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_utterances_by_participants</span><span class="p">(</span><span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[[</span><span class="n">u</span><span class="o">.</span><span class="n">tokens</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">us</span><span class="p">]</span> <span class="k">for</span> <span class="n">us</span> <span class="ow">in</span> <span class="n">utterances</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.tagged_words"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.tagged_words">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">tagged_words</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]]]:</span>
        <span class="sd">"""Return the tagged words.</span>

<span class="sd">        .. deprecated:: 0.13.0</span>
<span class="sd">            Please use :func:`~pylangacq.Reader.tokens` with ``by_utterances=False``</span>
<span class="sd">            instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[Token] if ``by_files`` is ``False``, otherwise List[List[Token]]</span>
<span class="sd">        """</span>
        <span class="n">_deprecate_warning</span><span class="p">(</span>
            <span class="s2">"tagged_words"</span><span class="p">,</span> <span class="s2">"0.13.0"</span><span class="p">,</span> <span class="s2">"the `.tokens()` method with by_utterances=False"</span>
        <span class="p">)</span>
        <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_utterances_by_participants</span><span class="p">(</span><span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[[</span><span class="n">word</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">us</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">tokens</span><span class="p">]</span> <span class="k">for</span> <span class="n">us</span> <span class="ow">in</span> <span class="n">utterances</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.sents"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.sents">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">sents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]:</span>
        <span class="sd">"""Return the sents.</span>

<span class="sd">        .. deprecated:: 0.13.0</span>
<span class="sd">            Please use :func:`~pylangacq.Reader.words` with ``by_utterances=True``</span>
<span class="sd">            instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[List[str]] if ``by_files`` is ``False``, otherwise List[List[List[str]]]</span>
<span class="sd">        """</span>
        <span class="n">_deprecate_warning</span><span class="p">(</span>
            <span class="s2">"words"</span><span class="p">,</span> <span class="s2">"0.13.0"</span><span class="p">,</span> <span class="s2">"the `.words()` method with by_utterances=True"</span>
        <span class="p">)</span>
        <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_utterances_by_participants</span><span class="p">(</span><span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[[</span><span class="n">t</span><span class="o">.</span><span class="n">word</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">tokens</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">us</span><span class="p">]</span> <span class="k">for</span> <span class="n">us</span> <span class="ow">in</span> <span class="n">utterances</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.mlum"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.mlum">[docs]</a>    <span class="k">def</span> <span class="nf">mlum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">participant</span><span class="o">=</span><span class="s2">"CHI"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""Return the mean lengths of utterance by morphemes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        participant : str, optional</span>
<span class="sd">            Participant of interest, which defaults to the typical use case of ``"CHI"``</span>
<span class="sd">            for the target child.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">_get_mlum</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">(</span><span class="n">participants</span><span class="o">=</span><span class="n">participant</span><span class="p">,</span> <span class="n">by_utterances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Reader.mlu"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.mlu">[docs]</a>    <span class="k">def</span> <span class="nf">mlu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">participant</span><span class="o">=</span><span class="s2">"CHI"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""Return the mean lengths of utterance (MLU).</span>

<span class="sd">        This method is equivalent to :func:`~pylangacq.Reader.mlum`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        participant : str, optional</span>
<span class="sd">            Participant of interest, which defaults to the typical use case of ``"CHI"``</span>
<span class="sd">            for the target child.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlum</span><span class="p">(</span><span class="n">participant</span><span class="o">=</span><span class="n">participant</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.mluw"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.mluw">[docs]</a>    <span class="k">def</span> <span class="nf">mluw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">participant</span><span class="o">=</span><span class="s2">"CHI"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""Return the mean lengths of utterance by words.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        participant : str, optional</span>
<span class="sd">            Participant of interest, which defaults to the typical use case of ``"CHI"``</span>
<span class="sd">            for the target child.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">_get_mluw</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="n">participants</span><span class="o">=</span><span class="n">participant</span><span class="p">,</span> <span class="n">by_utterances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Reader.ttr"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.ttr">[docs]</a>    <span class="k">def</span> <span class="nf">ttr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_case</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">participant</span><span class="o">=</span><span class="s2">"CHI"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""Return the type-token ratios (TTR).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        keep_case : bool, optional</span>
<span class="sd">            If ``True`` (the default), case distinctions are kept, e.g.,</span>
<span class="sd">            word tokens like "the" and "The" are treated as distinct.</span>
<span class="sd">            If ``False``, all word tokens are forced to be in lowercase</span>
<span class="sd">            as a preprocessing step.</span>
<span class="sd">            CHAT data from CHILDES intentionally does not follow the orthographic</span>
<span class="sd">            convention of capitalizing the first letter of a sentence in the</span>
<span class="sd">            transcriptions (as would have been done in many European languages),</span>
<span class="sd">            and so leaving keep_case as True is appropriate in most cases.</span>
<span class="sd">        participant : str, optional</span>
<span class="sd">            Participant of interest, which defaults to the typical use case of ``"CHI"``</span>
<span class="sd">            for the target child.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">_get_ttr</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">word_frequencies</span><span class="p">(</span>
                <span class="n">keep_case</span><span class="o">=</span><span class="n">keep_case</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="n">participant</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Reader.ipsyn"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.ipsyn">[docs]</a>    <span class="k">def</span> <span class="nf">ipsyn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">participant</span><span class="o">=</span><span class="s2">"CHI"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="sd">"""Return the indexes of productive syntax (IPSyn).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        participant : str, optional</span>
<span class="sd">            Participant of interest, which defaults to the typical use case of ``"CHI"``</span>
<span class="sd">            for the target child.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[float]</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">_get_ipsyn</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tokens</span><span class="p">(</span><span class="n">participants</span><span class="o">=</span><span class="n">participant</span><span class="p">,</span> <span class="n">by_utterances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Reader.word_ngrams"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.word_ngrams">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"keep_case"</span><span class="p">,</span> <span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">word_ngrams</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">keep_case</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">]]:</span>
        <span class="sd">"""Return word ngrams.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        collections.Counter if ``by_files`` is ``False``,</span>
<span class="sd">        otherwise List[collections.Counter]</span>
<span class="sd">        """</span>

        <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"n must be a positive integer: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">sents_in_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">(</span>
            <span class="n">participants</span><span class="o">=</span><span class="n">participants</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
            <span class="n">by_utterances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">result_for_file</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sents_in_file</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">keep_case</span><span class="p">:</span>
                    <span class="n">sent</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">sent</span><span class="p">]</span>
                <span class="n">ngrams</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">sent</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
                <span class="n">result_for_file</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ngrams</span><span class="p">)</span>
            <span class="n">result_by_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result_for_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.word_frequencies"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.word_frequencies">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"keep_case"</span><span class="p">,</span> <span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"by_files"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">word_frequencies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">keep_case</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">]]:</span>
        <span class="sd">"""Return word frequencies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        collections.Counter if ``by_files`` is ``False``,</span>
<span class="sd">        otherwise List[collections.Counter]</span>
<span class="sd">        """</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word_ngrams</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">keep_case</span><span class="o">=</span><span class="n">keep_case</span><span class="p">,</span>
            <span class="n">participants</span><span class="o">=</span><span class="n">participants</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
            <span class="n">by_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">result_by_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">({</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result_by_files</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">by_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result_by_files</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">,</span> <span class="n">result_by_files</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.from_strs"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.from_strs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"parallel"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_strs</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">strs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Instantiate a reader from in-memory CHAT data strings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strs : List[str]</span>
<span class="sd">            List of CHAT data strings. The ordering of the strings determines</span>
<span class="sd">            that of the parsed CHAT data in the resulting reader.</span>
<span class="sd">        ids : List[str], optional</span>
<span class="sd">            List of identifiers. If not provided, UUID random strings are used.</span>
<span class="sd">            When file paths are referred to in other parts of this package, they</span>
<span class="sd">            mean these identifiers if you have instantiated the reader by this method.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>
<span class="sd">        """</span>
        <span class="n">strs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_uuid</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strs</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"strs and ids must have the same size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">_parse_chat_strs</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">parallel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reader</span></div>

<div class="viewcode-block" id="Reader.from_files"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.from_files">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"match"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"encoding"</span><span class="p">,</span> <span class="s2">"parallel"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">match</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ENCODING</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Instantiate a reader from local CHAT data files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        paths : List[str]</span>
<span class="sd">            List of local file paths of the CHAT data. The ordering of the paths</span>
<span class="sd">            determines that of the parsed CHAT data in the resulting reader.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>
<span class="sd">        """</span>

        <span class="c1"># Inner function with file closing and closure to wrap in the given encoding</span>
        <span class="k">def</span> <span class="nf">_open_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_filter_file_paths</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">cf</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">strs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_open_file</span><span class="p">,</span> <span class="n">paths</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strs</span> <span class="o">=</span> <span class="p">[</span><span class="n">_open_file</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_strs</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_filter_file_paths</span><span class="p">(</span>
        <span class="n">paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">match</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">paths</span>

<div class="viewcode-block" id="Reader.from_dir"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.from_dir">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"match"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"extension"</span><span class="p">,</span> <span class="s2">"encoding"</span><span class="p">,</span> <span class="s2">"parallel"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_dir</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">match</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_CHAT_EXTENSION</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ENCODING</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Instantiate a reader from a local directory with CHAT data files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Local directory that contains CHAT data files. Files are searched for</span>
<span class="sd">            recursively under this directory, and those that satisfy ``match`` and</span>
<span class="sd">            ``extension`` are parsed and handled by the reader.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>
<span class="sd">        """</span>

        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">extension</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">file_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_files</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">file_paths</span><span class="p">),</span>
            <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span>
            <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
            <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
            <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Reader.from_zip"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.from_zip">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@_params_in_docstring</span><span class="p">(</span>
        <span class="s2">"match"</span><span class="p">,</span>
        <span class="s2">"exclude"</span><span class="p">,</span>
        <span class="s2">"extension"</span><span class="p">,</span>
        <span class="s2">"encoding"</span><span class="p">,</span>
        <span class="s2">"parallel"</span><span class="p">,</span>
        <span class="s2">"use_cached"</span><span class="p">,</span>
        <span class="s2">"session"</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_zip</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">match</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_CHAT_EXTENSION</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ENCODING</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_cached</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
        <span class="sd">"""Instantiate a reader from a local or remote ZIP file.</span>

<span class="sd">        If the input data is a remote ZIP file and you expect to call this method</span>
<span class="sd">        with the same path multiple times, consider downloading the data to the local</span>
<span class="sd">        system and then reading it from there to avoid unnecessary re-downloading.</span>
<span class="sd">        Caching a remote ZIP file isn't implemented (yet) as the upstream CHILDES /</span>
<span class="sd">        TalkBank data is updated in minor ways from time to time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Either a local file path or a URL (one that begins with ``"https://"``</span>
<span class="sd">            or ``"http://"``) for a ZIP file containing CHAT data files.</span>
<span class="sd">            For instance, you can provide either a local path to a ZIP file downloaded</span>
<span class="sd">            from CHILDES, or simply a URL such as</span>
<span class="sd">            ``"https://childes.talkbank.org/data/Eng-NA/Brown.zip"``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`pylangacq.Reader`</span>
<span class="sd">        """</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="n">is_url</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"https://"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"http://"</span><span class="p">)</span>
            <span class="n">unzip_dir</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_retrieve_unzip_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_url</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">is_url</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">use_cached</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">unzip_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">unzip_dir</span><span class="p">:</span>
                    <span class="n">remove_cached_data</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">zip_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
                <span class="n">_download_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">zip_path</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
                <span class="n">unzip_dir</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_create_unzip_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">is_url</span> <span class="ow">and</span> <span class="n">unzip_dir</span><span class="p">:</span>
                <span class="n">zip_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zip_path</span> <span class="o">=</span> <span class="n">path</span>
                <span class="n">unzip_dir</span> <span class="o">=</span> <span class="n">temp_dir</span>

            <span class="k">if</span> <span class="n">zip_path</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">zfile</span><span class="p">:</span>
                    <span class="n">zfile</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">unzip_dir</span><span class="p">)</span>

            <span class="n">reader</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span>
                <span class="n">unzip_dir</span><span class="p">,</span>
                <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span>
                <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span>
                <span class="n">extension</span><span class="o">=</span><span class="n">extension</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                <span class="n">parallel</span><span class="o">=</span><span class="n">parallel</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Unzipped files from `.from_zip` have the unwieldy temp dir in the file path.</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">_files</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">unzip_dir</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reader</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_retrieve_unzip_dir</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">existing_records</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">_CACHED_DATA_JSON_PATH</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">subdir</span> <span class="o">=</span> <span class="n">existing_records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"subdir"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_create_unzip_dir</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">):</span>
            <span class="n">_initialize_cached_data_dir</span><span class="p">()</span>

        <span class="n">subdir</span> <span class="o">=</span> <span class="n">_get_uuid</span><span class="p">()</span>
        <span class="n">unzip_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">unzip_dir</span><span class="p">)</span>

        <span class="n">new_record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"subdir"</span><span class="p">:</span> <span class="n">subdir</span><span class="p">,</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
            <span class="s2">"cached_at"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">existing_records</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">_CACHED_DATA_JSON_PATH</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
        <span class="n">_write_cached_data_json</span><span class="p">({</span><span class="o">**</span><span class="n">existing_records</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">url</span><span class="p">:</span> <span class="n">new_record</span><span class="p">}})</span>

        <span class="k">return</span> <span class="n">unzip_dir</span>

<div class="viewcode-block" id="Reader.to_strs"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.to_strs">[docs]</a>    <span class="k">def</span> <span class="nf">to_strs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tabular</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">"""Yield CHAT data strings.</span>

<span class="sd">        .. note::</span>
<span class="sd">            The header information may not be completely reproduced in the output</span>
<span class="sd">            CHAT strings. Known issues all have to do with a header field used</span>
<span class="sd">            multiple times in the original CHAT data.</span>
<span class="sd">            For ``Date``, only the first date of recording is retained in the output</span>
<span class="sd">            string.</span>
<span class="sd">            For all other multiply used header fields</span>
<span class="sd">            (e.g., ``Tape Location``, ``Time Duration``),</span>
<span class="sd">            only the last value in a given CHAT file is retained.</span>
<span class="sd">            Note that ``ID`` for participant information is not affected.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tabular : bool, optional</span>
<span class="sd">            If ``True``, adjust spacing such that the three tiers of the utterance,</span>
<span class="sd">            %mor, and %gra are aligned in a tabular form. Note that such alignment</span>
<span class="sd">            would drop annotations (e.g., pauses) on the main utterance tier.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        str</span>
<span class="sd">            CHAT data string for one file.</span>
<span class="sd">        """</span>
        <span class="n">header_first</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">"UTF8"</span><span class="p">,</span>
            <span class="s2">"PID"</span><span class="p">,</span>
            <span class="s2">"Languages"</span><span class="p">,</span>
            <span class="s2">"Participants"</span><span class="p">,</span>
            <span class="s2">"Date"</span><span class="p">,</span>
            <span class="s2">"Types"</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">:</span>
            <span class="n">str_for_file</span> <span class="o">=</span> <span class="s2">""</span>

            <span class="n">header_keys</span> <span class="o">=</span> <span class="n">_sort_keys</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">first</span><span class="o">=</span><span class="n">header_first</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">header_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"Languages"</span><span class="p">:</span>
                    <span class="n">str_for_file</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"@Languages:</span><span class="se">\t</span><span class="si">{</span><span class="s1">' , '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'Languages'</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"Participants"</span><span class="p">:</span>
                    <span class="n">participants</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">]</span>

                    <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">demographics</span> <span class="ow">in</span> <span class="n">participants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">demographics</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">demographics</span><span class="p">[</span><span class="s1">'role'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
                        <span class="p">)</span>
                    <span class="n">str_for_file</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"@Participants:</span><span class="se">\t</span><span class="si">{</span><span class="s1">' , '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>

                    <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">participants</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="c1"># d = demographics</span>
                        <span class="n">id_line</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'language'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'corpus'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'age'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'sex'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'group'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'ses'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'role'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'education'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">d</span><span class="p">[</span><span class="s1">'custom'</span><span class="p">]</span><span class="si">}</span><span class="s2">|"</span>
                        <span class="p">)</span>
                        <span class="n">str_for_file</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"@ID:</span><span class="se">\t</span><span class="si">{</span><span class="n">id_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>

                <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">"Date"</span><span class="p">:</span>
                    <span class="c1"># TODO: A CHAT file may have more than one recording date.</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">"Date"</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">str_for_file</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"@Date:</span><span class="se">\t</span><span class="si">{</span><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'</span><span class="si">%d</span><span class="s1">-%b-%Y'</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>

                <span class="k">elif</span> <span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                    <span class="n">str_for_file</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"@</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">str_for_file</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"@</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>

            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">utterances</span><span class="p">:</span>
                <span class="n">str_for_file</span> <span class="o">+=</span> <span class="n">u</span><span class="o">.</span><span class="n">_to_str</span><span class="p">(</span><span class="n">tabular</span><span class="o">=</span><span class="n">tabular</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">str_for_file</span></div>

<div class="viewcode-block" id="Reader.head"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.head">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Return the first several utterances.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int, optional</span>
<span class="sd">            The number of utterances to return.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of utterances</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_head_or_tail</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.tail"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.tail">[docs]</a>    <span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"participants"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">participants</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Return the last several utterances.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int, optional</span>
<span class="sd">            The number of utterances to return.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of utterances</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_head_or_tail</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_head_or_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slice_</span><span class="p">,</span> <span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="p">):</span>
        <span class="n">us</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">utterances</span><span class="p">(</span>
            <span class="n">participants</span><span class="o">=</span><span class="n">participants</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">by_files</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">slice_</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_list</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_info_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files"</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">utterances</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> utterances"</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">utterances</span><span class="p">)</span><span class="si">}</span><span class="s2"> words"</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_info_details_of_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">_File</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"Utterance Count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">utterances</span><span class="p">),</span>
            <span class="s2">"Word Count"</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">tokens</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">utterances</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_uuid</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">"File Path"</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">file_path</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Reader.info"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Print a summary of this Reader's data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            If ``True`` (default is ``False``), show the details of all the files.</span>
<span class="sd">        """</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_info_summary</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">details</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_info_details_of_file</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span>
        <span class="n">max_n_files_if_not_verbose</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">details</span> <span class="o">=</span> <span class="n">details</span><span class="p">[:</span><span class="n">max_n_files_if_not_verbose</span><span class="p">]</span>
            <span class="n">n_files</span> <span class="o">=</span> <span class="n">max_n_files_if_not_verbose</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_files</span><span class="p">()</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"#</span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_files</span><span class="p">))</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">details</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">...</span><span class="se">\n</span><span class="s2">(set `verbose` to True for all the files)"</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>

<div class="viewcode-block" id="Reader.to_chat"><a class="viewcode-back" href="../../api.html#pylangacq.Reader.to_chat">[docs]</a>    <span class="k">def</span> <span class="nf">to_chat</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">is_dir</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">filenames</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tabular</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ENCODING</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Export to CHAT data files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            The path to a file where you want to output the CHAT data,</span>
<span class="sd">            e.g., `"data.cha"`, `"foo/bar/data.cha"`.</span>
<span class="sd">        is_dir : bool, optional</span>
<span class="sd">            If ``True`` (default is ``False``), then ``path`` is interpreted as a</span>
<span class="sd">            directory instead.</span>
<span class="sd">            The CHAT data is written to possibly multiple files under this directory.</span>
<span class="sd">            The number of files you get can be checked by calling</span>
<span class="sd">            :func:`~pylangacq.Reader.n_files`, which depends on how this reader</span>
<span class="sd">            object is created.</span>
<span class="sd">        filenames : Iterable[str], optional</span>
<span class="sd">            Used only when ``is_dir`` is ``True``.</span>
<span class="sd">            These are the filenames of the CHAT files to write.</span>
<span class="sd">            If ``None`` or not given, {0001.cha, 0002.cha, ...} are used.</span>
<span class="sd">        tabular : bool, optional</span>
<span class="sd">            If ``True``, adjust spacing such that the three tiers of the utterance,</span>
<span class="sd">            %mor, and %gra are aligned in a tabular form. Note that such alignment</span>
<span class="sd">            would drop annotations (e.g., pauses) on the main utterance tier.</span>
<span class="sd">        encoding : str, optional</span>
<span class="sd">            Text encoding to output the CHAT data as. The default value is ``"utf-8"``</span>
<span class="sd">            for Unicode UTF-8.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            - If you attempt to output data to a single local file, but the CHAT</span>
<span class="sd">              data in this reader appears to be organized in multiple files.</span>
<span class="sd">            - If you attempt to output data to a directory while providing your own</span>
<span class="sd">              filenames, but the number of your filenames doesn't match</span>
<span class="sd">              the number of CHAT files in this reader object.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dir</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_files</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"The CHAT data in this reader object exists in more than one file. "</span>
                    <span class="s2">"(Call the `.n_files()` method to check.) It is not possible to "</span>
                    <span class="s2">"output data from multiple files to a single local file. "</span>
                    <span class="s2">"To output data, set `is_dir` to `True`, and pass in a directory "</span>
                    <span class="s2">"(not a file path) to `path`."</span>
                <span class="p">)</span>
            <span class="n">dir_</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">basename</span> <span class="ow">and</span> <span class="n">dir_</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"You've passed in </span><span class="si">{</span><span class="n">dir_</span><span class="si">}</span><span class="s2"> as `path` that looks like a directory "</span>
                    <span class="sa">f</span><span class="s2">"instead of a path to a file, because </span><span class="si">{</span><span class="n">dir_</span><span class="si">}</span><span class="s2"> ends with the "</span>
                    <span class="sa">f</span><span class="s2">"directory separator </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">. "</span>
                    <span class="s2">"As an example, a path to a file should look like "</span>
                    <span class="sa">f</span><span class="s2">"foo</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="si">}</span><span class="s2">bar.cha"</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">basename</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"You've passed in </span><span class="si">{</span><span class="n">dir_</span><span class="si">}</span><span class="s2"> as `path`, but it doesn't look like "</span>
                    <span class="s2">"a path to a file."</span>
                <span class="p">)</span>
            <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">basename</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dir_</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">if</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">.cha"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> CHAT files to create, "</span>
                    <span class="sa">f</span><span class="s2">"but you've provided </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">)</span><span class="si">}</span><span class="s2"> filenames."</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">dir_</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lines</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_strs</span><span class="p">(</span><span class="n">tabular</span><span class="o">=</span><span class="n">tabular</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_parse_chat_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_str</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_File</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lines</span><span class="p">(</span><span class="n">chat_str</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_header</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">all_tiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_tiers</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">utterances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_utterances</span><span class="p">(</span><span class="n">all_tiers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_File</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">utterances</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_participant_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tier_markers</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">tier_marker</span> <span class="ow">in</span> <span class="n">tier_markers</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tier_marker</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"%"</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">tier_marker</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_utterances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_tiers</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Utterance</span><span class="p">]:</span>
        <span class="n">result_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">tiermarker_to_line</span> <span class="ow">in</span> <span class="n">all_tiers</span><span class="p">:</span>
            <span class="n">participant_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_participant_code</span><span class="p">(</span><span class="n">tiermarker_to_line</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">participant_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># get the plain words from utterance tier</span>
            <span class="n">utterance_line</span> <span class="o">=</span> <span class="n">_clean_utterance</span><span class="p">(</span><span class="n">tiermarker_to_line</span><span class="p">[</span><span class="n">participant_code</span><span class="p">])</span>
            <span class="n">forms</span> <span class="o">=</span> <span class="n">utterance_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="c1"># %mor tier</span>
            <span class="n">clitic_indices</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># indices at the word items</span>
            <span class="n">clitic_count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">mor_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s2">"%mor"</span> <span class="ow">in</span> <span class="n">tiermarker_to_line</span><span class="p">:</span>
                <span class="n">mor_split</span> <span class="o">=</span> <span class="n">tiermarker_to_line</span><span class="p">[</span><span class="s2">"%mor"</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mor_split</span><span class="p">):</span>
                    <span class="n">tilde_count</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">"~"</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">tilde_count</span><span class="p">:</span>
                        <span class="n">item_split</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"~"</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tilde_count</span><span class="p">):</span>
                            <span class="n">clitic_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clitic_count</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">clitic_count</span> <span class="o">+=</span> <span class="mi">1</span>

                            <span class="n">mor_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_split</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

                        <span class="n">mor_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_split</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mor_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mor_items</span> <span class="ow">and</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">forms</span><span class="p">)</span> <span class="o">+</span> <span class="n">clitic_count</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mor_items</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">"cannot align the utterance and %mor tiers:</span><span class="se">\n</span><span class="s2">"</span>
                    <span class="sa">f</span><span class="s2">"Tiers --</span><span class="se">\n</span><span class="si">{</span><span class="n">tiermarker_to_line</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
                    <span class="sa">f</span><span class="s2">"Cleaned-up utterance --</span><span class="se">\n</span><span class="si">{</span><span class="n">utterance_line</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="c1"># %gra tier</span>
            <span class="n">gra_items</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">tiermarker_to_line</span><span class="p">[</span><span class="s2">"</span><span class="si">%g</span><span class="s2">ra"</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">"</span><span class="si">%g</span><span class="s2">ra"</span> <span class="ow">in</span> <span class="n">tiermarker_to_line</span>
                <span class="k">else</span> <span class="p">[]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">mor_items</span> <span class="ow">and</span> <span class="n">gra_items</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mor_items</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gra_items</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"cannot align the %mor and %gra tiers:</span><span class="se">\n</span><span class="si">{</span><span class="n">tiermarker_to_line</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="c1"># utterance tier</span>
            <span class="k">if</span> <span class="n">mor_items</span> <span class="ow">and</span> <span class="n">clitic_count</span><span class="p">:</span>
                <span class="n">word_iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">forms</span><span class="p">)</span>
                <span class="n">utterance_items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">""</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">mor_items</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mor_items</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">clitic_indices</span><span class="p">:</span>
                        <span class="n">utterance_items</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CLITIC</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">utterance_items</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">word_iterator</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">utterance_items</span> <span class="o">=</span> <span class="n">forms</span>

            <span class="c1"># determine what to yield (and how) to create the generator</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mor_items</span><span class="p">:</span>
                <span class="n">mor_items</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">utterance_items</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gra_items</span><span class="p">:</span>
                <span class="n">gra_items</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">utterance_items</span><span class="p">)</span>

            <span class="n">sent</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Token</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">mor</span><span class="p">,</span> <span class="n">gra</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">utterance_items</span><span class="p">,</span> <span class="n">mor_items</span><span class="p">,</span> <span class="n">gra_items</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pos</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mor</span> <span class="o">=</span> <span class="n">mor</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">"|"</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">pos</span><span class="p">,</span> <span class="n">mor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

                <span class="n">output_word</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span>
                    <span class="n">_clean_word</span><span class="p">(</span><span class="n">word</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span>
                    <span class="n">mor</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_gra</span><span class="p">(</span><span class="n">gra</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_token</span><span class="p">(</span><span class="n">output_word</span><span class="p">))</span>

            <span class="n">time_marks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time_marks</span><span class="p">(</span><span class="n">tiermarker_to_line</span><span class="p">[</span><span class="n">participant_code</span><span class="p">])</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Utterance</span><span class="p">(</span><span class="n">participant_code</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">time_marks</span><span class="p">,</span> <span class="n">tiermarker_to_line</span><span class="p">)</span>
            <span class="n">result_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_utterance</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_preprocess_token</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">Token</span><span class="p">):</span>
        <span class="sd">"""Override this method in a child class for custom behavior."""</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_preprocess_utterance</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="n">Utterance</span><span class="p">):</span>
        <span class="sd">"""Override this method in a child class for custom behavior."""</span>
        <span class="k">return</span> <span class="n">u</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_preprocess_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">"""If POS tag preprocessing is needed, create a child class of Reader and</span>
<span class="sd">        override this method."""</span>
        <span class="k">return</span> <span class="n">pos</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_time_marks</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">_TIMER_MARKS_REGEX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
            <span class="n">time_marks</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_marks</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_marks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_gra</span><span class="p">(</span><span class="n">raw_gra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Gra</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">raw_gra</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dep</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">rel</span> <span class="o">=</span> <span class="n">raw_gra</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"|"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
            <span class="n">head</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Gra</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_all_tiers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="n">index_to_tiers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">index_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># utterance index (1st utterance is index 0)</span>
        <span class="n">utterance</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"@"</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"*"</span><span class="p">):</span>
                <span class="n">index_</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">participant_code</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">"*"</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">":"</span><span class="p">)</span>
                <span class="n">utterance</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">index_to_tiers</span><span class="p">[</span><span class="n">index_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">participant_code</span><span class="p">:</span> <span class="n">utterance</span><span class="p">}</span>

            <span class="k">elif</span> <span class="n">utterance</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"%"</span><span class="p">):</span>
                <span class="n">tier_marker</span> <span class="o">=</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">":"</span><span class="p">)</span>
                <span class="n">index_to_tiers</span><span class="p">[</span><span class="n">index_</span><span class="p">][</span><span class="n">tier_marker</span><span class="p">]</span> <span class="o">=</span> <span class="s2">" "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">return</span> <span class="n">index_to_tiers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_header</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">headname_to_entry</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>

            <span class="n">header_re_search</span> <span class="o">=</span> <span class="n">_HEADER_REGEX</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">header_re_search</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"@Begin"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"@End"</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># find head, e.g., "Languages", "Participants", "ID" etc</span>
            <span class="n">head</span> <span class="o">=</span> <span class="n">header_re_search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">header_re_search</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">"Participants"</span><span class="p">:</span>

                <span class="n">participants</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">participant</span> <span class="ow">in</span> <span class="n">participants</span><span class="p">:</span>
                    <span class="n">participant</span> <span class="o">=</span> <span class="n">participant</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">code</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">participant_label</span> <span class="o">=</span> <span class="n">participant</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
                    <span class="p">(</span>
                        <span class="n">participant_name</span><span class="p">,</span>
                        <span class="n">_</span><span class="p">,</span>
                        <span class="n">participant_role</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">participant_label</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
                    <span class="c1"># code = participant code, e.g. CHI, MOT</span>
                    <span class="k">if</span> <span class="s2">"Participants"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headname_to_entry</span><span class="p">:</span>
                        <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">][</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="n">participant_name</span><span class="p">}</span>

            <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">"ID"</span><span class="p">:</span>
                <span class="n">participant_info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"|"</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># final empty str removed</span>

                <span class="n">code</span> <span class="o">=</span> <span class="n">participant_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1"># participant_info contains these in order:</span>
                <span class="c1">#   language, corpus, code, age, sex, group, SES, role,</span>
                <span class="c1">#   education, custom</span>

                <span class="k">del</span> <span class="n">participant_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># remove code info (3rd in list)</span>
                <span class="n">participant_info_heads</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">"language"</span><span class="p">,</span>
                    <span class="s2">"corpus"</span><span class="p">,</span>
                    <span class="s2">"age"</span><span class="p">,</span>
                    <span class="s2">"sex"</span><span class="p">,</span>
                    <span class="s2">"group"</span><span class="p">,</span>
                    <span class="s2">"ses"</span><span class="p">,</span>
                    <span class="s2">"role"</span><span class="p">,</span>
                    <span class="s2">"education"</span><span class="p">,</span>
                    <span class="s2">"custom"</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">head_to_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">participant_info_heads</span><span class="p">,</span> <span class="n">participant_info</span><span class="p">))</span>

                <span class="k">if</span> <span class="s2">"Participants"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headname_to_entry</span><span class="p">:</span>
                    <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">]:</span>
                    <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">][</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">][</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">head_to_info</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">"Date"</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header_line_to_date</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">ParserError</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="s2">"Date"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headname_to_entry</span><span class="p">:</span>
                    <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Date"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Date"</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">head</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"Birth of"</span><span class="p">):</span>
                <span class="c1"># e.g., header is 'Birth of CHI', participant is 'CHI'</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">participant</span> <span class="o">=</span> <span class="n">head</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header_line_to_date</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">ParserError</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">participant</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">]:</span>
                    <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">][</span><span class="n">participant</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Participants"</span><span class="p">][</span><span class="n">participant</span><span class="p">][</span><span class="s2">"dob"</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span>

            <span class="k">elif</span> <span class="n">head</span> <span class="o">==</span> <span class="s2">"Languages"</span><span class="p">:</span>
                <span class="n">languages</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># not set; ordering indicates language dominance</span>
                <span class="k">for</span> <span class="n">language</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">):</span>
                    <span class="n">language</span> <span class="o">=</span> <span class="n">language</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
                        <span class="n">languages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
                <span class="n">headname_to_entry</span><span class="p">[</span><span class="s2">"Languages"</span><span class="p">]</span> <span class="o">=</span> <span class="n">languages</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">headname_to_entry</span><span class="p">[</span><span class="n">head</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span> <span class="ow">or</span> <span class="s2">""</span>

        <span class="k">return</span> <span class="n">headname_to_entry</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">headname_to_entry</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_header_line_to_date</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_lines</span><span class="p">(</span><span class="n">raw_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_str</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_str</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_str</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># TODO: Why did I do this?</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"</span><span class="si">%x</span><span class="s2">pho:"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"</span><span class="si">%x</span><span class="s2">mod:"</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"</span><span class="si">%x</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"%"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_CHAT_LINE_INDICATORS</span><span class="p">:</span>
                <span class="n">previous_line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">previous_line</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span>

            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span></div>


<span class="k">def</span> <span class="nf">_get_uuid</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">"""This function goes hand-in-hand with _is_uuid() below."""</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">_is_uuid</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">"""This function goes hand-in-hand with _get_uuid() above."""</span>
    <span class="c1"># Implementation from https://stackoverflow.com/a/33245493</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uuid_obj</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid_obj</span><span class="p">)</span> <span class="o">==</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">_initialize_cached_data_dir</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">):</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">,</span> <span class="s2">"README.txt"</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">"The contents of this directory are automatically managed by "</span>
            <span class="s2">"the PyLangAcq library. Please do not edit anything on your own.</span><span class="se">\n</span><span class="s2">"</span>
        <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_CACHED_DATA_JSON_PATH</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_write_cached_data_json</span><span class="p">(</span><span class="n">records</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_CACHED_DATA_JSON_PATH</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>


<div class="viewcode-block" id="cached_data_info"><a class="viewcode-back" href="../../api.html#pylangacq.cached_data_info">[docs]</a><span class="k">def</span> <span class="nf">cached_data_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">"""Return the information of the cached datasets.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Set[str]</span>
<span class="sd">        A set of the URLs for the cached CHILDES / TalkBank datasets.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">existing_records</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">_CACHED_DATA_JSON_PATH</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">existing_records</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="remove_cached_data"><a class="viewcode-back" href="../../api.html#pylangacq.remove_cached_data">[docs]</a><span class="k">def</span> <span class="nf">remove_cached_data</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Remove data cached on disk.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    url : str, optional</span>
<span class="sd">        If provided, remove only the data specified by this URL. If not provided,</span>
<span class="sd">        all cached data is removed.</span>
<span class="sd">    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">existing_records</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">_CACHED_DATA_JSON_PATH</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">_initialize_cached_data_dir</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s2">"subdir"</span><span class="p">]</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">existing_records</span><span class="o">.</span><span class="n">values</span><span class="p">()]:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">,</span> <span class="n">subdir</span><span class="p">))</span>
        <span class="n">_initialize_cached_data_dir</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subdir</span> <span class="o">=</span> <span class="n">existing_records</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"subdir"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subdir</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">existing_records</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
            <span class="n">_write_cached_data_json</span><span class="p">(</span><span class="n">existing_records</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_CACHED_DATA_DIR</span><span class="p">,</span> <span class="n">subdir</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"url not found among the cached data: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span></div>


<div class="viewcode-block" id="read_chat"><a class="viewcode-back" href="../../api.html#pylangacq.read_chat">[docs]</a><span class="nd">@_params_in_docstring</span><span class="p">(</span><span class="s2">"match"</span><span class="p">,</span> <span class="s2">"exclude"</span><span class="p">,</span> <span class="s2">"encoding"</span><span class="p">,</span> <span class="s2">"cls"</span><span class="p">,</span> <span class="n">class_method</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_chat</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">match</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_ENCODING</span><span class="p">,</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"pylangacq.Reader"</span><span class="p">:</span>
    <span class="sd">"""Create a reader of CHAT data.</span>

<span class="sd">    If ``path`` is a remote ZIP file and you expect to call this function</span>
<span class="sd">    with the same path multiple times, consider downloading the data to the local</span>
<span class="sd">    system and then reading it from there to avoid unnecessary re-downloading.</span>
<span class="sd">    Caching a remote ZIP file isn't implemented (yet) as the upstream CHILDES /</span>
<span class="sd">    TalkBank data is updated in minor ways from time to time.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        A path that points to one of the following:</span>

<span class="sd">        - ZIP file. Either a local ``.zip`` file path or a URL (one that begins with</span>
<span class="sd">          ``"https://"`` or ``"http://"``).</span>
<span class="sd">          Example of a URL: ``"https://childes.talkbank.org/data/Eng-NA/Brown.zip"``</span>
<span class="sd">        - A local directory, for files under this directory recursively.</span>
<span class="sd">        - A single ``.cha`` CHAT file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    :class:`~pylangacq.Reader`</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="o">!=</span> <span class="n">Reader</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">Reader</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Only a Reader class or its child class is allowed: </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Just in case the user provides a CHILDES web link like</span>
    <span class="c1"># https://childes.talkbank.org/access/Eng-NA/Brown.html</span>
    <span class="c1"># instead of https://childes.talkbank.org/data/Eng-NA/Brown.zip.</span>
    <span class="c1"># The subdomain can be "childes", "phonbank", "ca", etc.</span>
    <span class="c1"># This hack is just for convenience.</span>
    <span class="c1"># Not sure if we should encourage using the .html link,</span>
    <span class="c1"># since I can't guarantee the URL format...</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://\S+\.talkbank\.org/access/\S+\.html"</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"/access/"</span><span class="p">,</span> <span class="s2">"/data/"</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">".html"</span><span class="p">,</span> <span class="s2">".zip"</span><span class="p">)</span>

    <span class="n">path_lower</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">path_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">".zip"</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">path_lower</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">_CHAT_EXTENSION</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_files</span><span class="p">([</span><span class="n">path</span><span class="p">],</span> <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">"path is not one of the accepted choices of "</span>
            <span class="sa">f</span><span class="s2">"</span><span class="se">{{</span><span class="s2">.zip file, local directory, .cha file</span><span class="se">}}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_clean_word</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
    <span class="sd">"""Clean the word.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    word : str</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    """</span>
    <span class="n">new_word</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"("</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">")"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">":"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">";"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"+"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="s2">"@"</span> <span class="ow">in</span> <span class="n">new_word</span><span class="p">:</span>
        <span class="n">new_word</span> <span class="o">=</span> <span class="n">new_word</span><span class="p">[:</span> <span class="n">new_word</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">"@"</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">new_word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"&amp;"</span><span class="p">):</span>
        <span class="n">new_word</span> <span class="o">=</span> <span class="n">new_word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">new_word</span>


<span class="k">class</span> <span class="nc">_HTTPSession</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="n">Retry</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="o">=</span><span class="n">backoff_factor</span><span class="p">)</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">"http://"</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">"https://"</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">"timeout"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">_HTTPSession</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">_HTTPSession</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2015-2022, Jackson L. Lee | PyLangAcq 0.16.1 | Documentation last updated on March 17, 2022
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>